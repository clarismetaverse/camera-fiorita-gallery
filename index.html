<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Camera</title>
  <style>
    :root {
      --bg: #2f3f3c;
      --bg-soft: #3a4c48;
      --accent: #f4c06b;
      --text-main: #ffffff;
      --text-soft: #d7e0dd;
      --chip-bg: rgba(0, 0, 0, 0.45);
      --radius-xl: 18px;
      --shadow-soft: 0 16px 40px rgba(0, 0, 0, 0.45);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text-main);
      padding: 16px;
    }

    .room-card {
      max-width: 480px;
      margin: 0 auto;
      background: linear-gradient(145deg, #2d3a38, #1f2927);
      border-radius: 24px;
      overflow: hidden;
      box-shadow: var(--shadow-soft);
      animation: fadeIn 500ms ease-out;
    }

    /* HEADER IMAGE */

    .room-header {
      position: relative;
      overflow: hidden;
      height: 260px;
      background: #000;
    }

    .room-header img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
      transform: scale(1.03);
      transition: transform 900ms ease-out;
    }

    .room-card.loaded .room-header img {
      transform: scale(1);
    }

    .room-header-overlay {
      position: absolute;
      inset: 0;
      background: linear-gradient(
        to bottom,
        rgba(0, 0, 0, 0.35),
        rgba(0, 0, 0, 0.75)
      );
    }

    .room-header-content {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      justify-content: flex-end;
      padding: 16px 18px 20px;
      gap: 6px;
    }

    .room-pill {
      align-self: flex-start;
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(0, 0, 0, 0.55);
      color: var(--text-soft);
      font-size: 11px;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .room-title {
      font-size: 20px;
      font-weight: 600;
    }

    .room-subtitle {
      font-size: 13px;
      color: var(--text-soft);
    }

    /* METRICS */

    .room-metrics {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .metric-chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: var(--chip-bg);
      font-size: 12px;
      color: var(--text-soft);
    }

    .metric-icon {
      width: 16px;
      height: 16px;
      border-radius: 4px;
      background: rgba(255, 255, 255, 0.12);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 10px;
    }

    /* CONTENT */

    .room-body {
      padding: 16px 18px 18px;
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .room-description {
      font-size: 13px;
      line-height: 1.6;
      color: var(--text-soft);
      position: relative;
      max-height: 3.6em; /* ~2 righe */
      overflow: hidden;
      transition: max-height 250ms ease-out;
    }

    .room-description.expanded {
      max-height: 500px;
    }

    .room-description::after {
      content: "";
      position: absolute;
      inset-inline: 0;
      bottom: 0;
      height: 24px;
      background: linear-gradient(
        to bottom,
        rgba(47, 63, 60, 0),
        rgba(47, 63, 60, 1)
      );
      pointer-events: none;
      transition: opacity 160ms ease-out;
    }

    .room-description.expanded::after {
      opacity: 0;
    }

    .toggle-description {
      font-size: 12px;
      color: var(--accent);
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      margin-top: 6px;
    }

    .toggle-description span {
      font-size: 14px;
      transform: translateY(1px);
    }

    /* GALLERY */

    .gallery-title {
      font-size: 13px;
      font-weight: 500;
      color: var(--text-soft);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      margin-top: 2px;
      margin-bottom: 4px;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }

    @media (min-width: 460px) {
      .gallery-grid {
        grid-template-columns: 1fr 1fr;
      }
    }

    .gallery-item {
      border-radius: var(--radius-xl);
      overflow: hidden;
      position: relative;
      background: #000;
      cursor: zoom-in;
    }

    .gallery-item img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      display: block;
      transition: transform 300ms ease-out, opacity 200ms ease-out;
      opacity: 0.92;
    }

    .gallery-item:hover img {
      transform: scale(1.03);
      opacity: 1;
    }

    .gallery-count-chip {
      margin-top: 4px;
      align-self: flex-start;
      padding: 4px 9px;
      border-radius: 999px;
      background: rgba(255, 255, 255, 0.06);
      color: var(--text-soft);
      font-size: 11px;
    }

    /* FULLSCREEN LIGHTBOX (inside iframe, best effort) */

    .lightbox {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.95);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 9999;
      padding: 12px;
    }

    .lightbox.open {
      display: flex;
    }

    .lightbox-img-wrap {
      max-width: 100%;
      max-height: 100%;
    }

    .lightbox-img-wrap img {
      max-width: 100%;
      max-height: 100%;
      object-fit: contain;
      display: block;
      border-radius: 10px;
    }

    .lightbox-close {
      position: fixed;
      top: 16px;
      right: 16px;
      width: 32px;
      height: 32px;
      border-radius: 999px;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.7);
      color: #fff;
      font-size: 18px;
      cursor: pointer;
    }

    /* GENERIC */

    .error {
      padding: 20px;
      text-align: center;
      color: #ffb3b3;
      font-size: 13px;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <div id="root"></div>

  <!-- lightbox solo per mobile / dentro iframe -->
  <div class="lightbox" id="lightbox">
    <button class="lightbox-close" id="lightboxClose">√ó</button>
    <div class="lightbox-img-wrap">
      <img id="lightboxImg" src="" alt="Foto camera" />
    </div>
  </div>

  <script>
    const CAMERA_ENDPOINT =
      "https://xbut-eryu-hhsg.f2.xano.io/api:X1XvnYjh/camera_cascina";
    const GALLERY_ENDPOINT =
      "https://xbut-eryu-hhsg.f2.xano.io/api:X1XvnYjh/Cascina";

    function getQueryParam(name, fallback = "") {
      const params = new URLSearchParams(window.location.search);
      return params.get(name) || fallback;
    }

    const roomNameRaw = getQueryParam("name", "Libri"); // default per debug
    const roomName = decodeURIComponent(roomNameRaw);

    const root = document.getElementById("root");

    async function fetchRoomData() {
      const cameraReq = fetch(CAMERA_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ Name: roomName })
      });

      const galleryReq = fetch(GALLERY_ENDPOINT);

      const [cameraRes, galleryRes] = await Promise.all([cameraReq, galleryReq]);

      if (!cameraRes.ok) throw new Error("Errore camera");
      if (!galleryRes.ok) throw new Error("Errore galleria");

      const cameraJson = await cameraRes.json();
      const galleryJson = await galleryRes.json();

      const camera = Array.isArray(cameraJson) ? cameraJson[0] : cameraJson;

      if (!camera) throw new Error("Camera non trovata");

      const gallery = Array.isArray(galleryJson)
        ? galleryJson.filter((item) => item.Stanza === roomName)
        : [];

      return { camera, gallery };
    }

    function createMetricChip(iconChar, label) {
      const chip = document.createElement("div");
      chip.className = "metric-chip";

      const icon = document.createElement("div");
      icon.className = "metric-icon";
      icon.textContent = iconChar;

      const span = document.createElement("span");
      span.textContent = label;

      chip.appendChild(icon);
      chip.appendChild(span);
      return chip;
    }

    function openLightbox(src) {
      const lb = document.getElementById("lightbox");
      const img = document.getElementById("lightboxImg");
      img.src = src;
      lb.classList.add("open");
    }

    function closeLightbox() {
      const lb = document.getElementById("lightbox");
      const img = document.getElementById("lightboxImg");
      img.src = "";
      lb.classList.remove("open");
    }

    document
      .getElementById("lightboxClose")
      .addEventListener("click", closeLightbox);

    document.getElementById("lightbox").addEventListener("click", (e) => {
      if (e.target.id === "lightbox") closeLightbox();
    });

    async function init() {
      try {
        const { camera, gallery } = await fetchRoomData();

        const wrapper = document.createElement("div");
        wrapper.className = "room-card";

        /* HEADER */
        const header = document.createElement("div");
        header.className = "room-header";

        const headerImg = document.createElement("img");
        headerImg.src = camera.Head?.url || "";
        headerImg.alt = camera.Title || roomName;

        const overlay = document.createElement("div");
        overlay.className = "room-header-overlay";

        const headerContent = document.createElement("div");
        headerContent.className = "room-header-content";

        const pill = document.createElement("div");
        pill.className = "room-pill";
        pill.textContent = "Suite";

        const title = document.createElement("h1");
        title.className = "room-title";
        title.textContent = camera.Title || roomName;

        const subtitle = document.createElement("p");
        subtitle.className = "room-subtitle";
        subtitle.textContent =
          camera.Subtitle || "Camera accogliente nella natura";

        const metrics = document.createElement("div");
        metrics.className = "room-metrics";

        // letti: per ora fisso 2 oppure query param ?beds=
        const bedsParam = getQueryParam("beds", "");
        const bedsNum = bedsParam || "2";
        metrics.appendChild(createMetricChip("üõè", `${bedsNum} ospiti`));

        if (camera.Meters) {
          metrics.appendChild(
            createMetricChip("„é°", `${camera.Meters} m¬≤`)
          );
        }

        headerContent.appendChild(pill);
        headerContent.appendChild(title);
        headerContent.appendChild(subtitle);
        headerContent.appendChild(metrics);

        header.appendChild(headerImg);
        header.appendChild(overlay);
        header.appendChild(headerContent);

        /* BODY */
        const body = document.createElement("div");
        body.className = "room-body";

        // descrizione + toggle
        const desc = document.createElement("p");
        desc.className = "room-description";
        desc.textContent =
          camera.Description ||
          "Descrizione in arrivo. Una camera accogliente immersa nel verde.";

        const toggleDesc = document.createElement("a");
        toggleDesc.href = "#";
        toggleDesc.className = "toggle-description";
        toggleDesc.innerHTML =
          '<span>‚ñæ</span><span>Mostra descrizione</span>';

        let expanded = false;
        toggleDesc.addEventListener("click", (e) => {
          e.preventDefault();
          expanded = !expanded;
          desc.classList.toggle("expanded", expanded);
          toggleDesc.innerHTML = expanded
            ? '<span>‚ñ¥</span><span>Nascondi descrizione</span>'
            : '<span>‚ñæ</span><span>Mostra descrizione</span>';
        });

        body.appendChild(desc);
        body.appendChild(toggleDesc);

        // GALLERIA
        const galleryTitle = document.createElement("div");
        galleryTitle.className = "gallery-title";
        galleryTitle.textContent = "Foto della camera";

        body.appendChild(galleryTitle);

        if (!gallery.length) {
          const noPhotos = document.createElement("div");
          noPhotos.className = "error";
          noPhotos.textContent =
            "Le foto di questa camera saranno disponibili a breve.";
          body.appendChild(noPhotos);
        } else {
          const grid = document.createElement("div");
          grid.className = "gallery-grid";

          gallery.forEach((item) => {
            const cell = document.createElement("div");
            cell.className = "gallery-item";

            const img = document.createElement("img");
            img.src = item.Picture?.url || "";
            img.alt = `${camera.Title || roomName} - foto`;

            img.loading = "lazy";
            cell.appendChild(img);

            cell.addEventListener("click", () => {
              if (item.Picture?.url) {
                openLightbox(item.Picture.url);
              }
            });

            grid.appendChild(cell);
          });

          body.appendChild(grid);

          const countChip = document.createElement("div");
          countChip.className = "gallery-count-chip";
          countChip.textContent = `${gallery.length} foto in totale`;
          body.appendChild(countChip);
        }

        wrapper.appendChild(header);
        wrapper.appendChild(body);
        root.appendChild(wrapper);

        // per triggerare la micro animazione dell'immagine
        requestAnimationFrame(() => {
          wrapper.classList.add("loaded");
        });
      } catch (err) {
        console.error(err);
        root.innerHTML =
          '<div class="error">Non riusciamo a caricare questa camera. Riprova pi√π tardi.</div>';
      }
    }

    init();
  </script>
</body>
</html>


   
